#!/bin/bash

set -e


#もし午前なら前日の日付で作成
if [ "$(date '+%p')" = "午前" ];then
  datetime=$(date -d '1days ago'  '+%Y-%m-%d')
else
  #日付ファイルの作成
  datetime=$(date '+%Y-%m-%d')
fi


file="$HOME/Dropbox/Diary/${datetime}.txt"

#ファイルが存在しないなら
if [ ! -e $file ];then
  #作成
  echo "${datetime}の日記を新規に作成します。"
  sleep 0.5
  touch "$file";
  echo $datetime >> "$file";
else
  while :
  do
    echo "${datetime}の日記を作り直しますか？(y/n)"
    read -n 2 ANSWER
    case "$ANSWER"  in
      [yY])
            rm -f "$file";
            touch "$file";
            echo $datetime >> "$file";
            echo "削除して作り直します。"
            sleep 0.5
            break ;;
      [nN]) echo "そのまま開きます" ;
            sleep 0.5
            break ;;
      *)  : ;;
    esac
  done
fi

#vimで開く
vim "$file"

#正常終了
exit 0
